-- ================================
-- SERVICES
-- ================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- ================================
-- MODULE REFERENCES
-- ================================
local TraitsModule = nil
local AnimalsModule = nil
local MutationsModule = nil

pcall(function()
    TraitsModule = require(ReplicatedStorage.Shared.Data.Traits)
    AnimalsModule = require(ReplicatedStorage.Shared.Data.Animals)
    MutationsModule = require(ReplicatedStorage.Shared.Data.Mutations)
end)

-- ================================
-- GRAPPLE SETUP
-- ================================
local UseItemRemote = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("Net")
    :WaitForChild("RE/UseItem")

local autoGrappleConnection = nil

local function autoEquipGrapple()
    local success, result = pcall(function()
        local character = player.Character
        if not character then return false end
        
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if not (humanoid and humanoid.Health > 0) then return false end
        
        local backpack = player:WaitForChild("Backpack")
        local grapple = backpack:FindFirstChild("Grapple Hook")
        
        if grapple then
            grapple.Parent = character
            humanoid:EquipTool(grapple)
            return true
        end
        return false
    end)
    return success and result
end

local function fireGrapple()
    pcall(function()
        local args = {1.9832406361897787}
        UseItemRemote:FireServer(unpack(args))
    end)
end

local function startAutoGrapple()
    if autoGrappleConnection then return end
    autoGrappleConnection = RunService.Heartbeat:Connect(function()
        autoEquipGrapple()
        fireGrapple()
    end)
end

local function stopAutoGrapple()
    if autoGrappleConnection then
        autoGrappleConnection:Disconnect()
        autoGrappleConnection = nil
    end
end

-- ================================
-- PET DETECTION FUNCTIONS
-- ================================
local function getTraitMultiplier(model)
    if not TraitsModule then return 0 end
    
    local traitJson = model:GetAttribute("Traits")
    if not traitJson or traitJson == "" then return 0 end

    local traits = {}
    local ok, decoded = pcall(function()
        return HttpService:JSONDecode(traitJson)
    end)

    if ok and typeof(decoded) == "table" then
        traits = decoded
    else
        for t in string.gmatch(traitJson, "[^,]+") do
            table.insert(traits, t)
        end
    end

    local mult = 0
    for _, entry in pairs(traits) do
        local name = typeof(entry) == "table" and entry.Name or tostring(entry)
        name = name:gsub("^_Trait%.", "")

        local trait = TraitsModule[name]
        if trait and trait.MultiplierModifier then
            mult += tonumber(trait.MultiplierModifier) or 0
        end
    end
    return mult
end

local function getFinalGeneration(model)
    if not AnimalsModule then return 0 end
    
    local animalData = AnimalsModule[model.Name]
    if not animalData then return 0 end

    local baseGen = tonumber(animalData.Generation) or tonumber(animalData.Price or 0)
    local traitMult = getTraitMultiplier(model)

    local mutationMult = 0
    if MutationsModule then
        local mutation = model:GetAttribute("Mutation")
        if mutation and MutationsModule[mutation] then
            mutationMult = tonumber(MutationsModule[mutation].Modifier or 0)
        end
    end

    local final = baseGen * (1 + traitMult + mutationMult)
    return math.max(1, math.round(final))
end

local function isPlayerPlot(plot)
    local plotSign = plot:FindFirstChild("PlotSign")
    if plotSign then
        local yourBase = plotSign:FindFirstChild("YourBase")
        if yourBase and yourBase.Enabled then
            return true
        end
    end
    return false
end

local function findTheAbsoluteBestPet()
    local plots = workspace:FindFirstChild("Plots")
    if not plots then return nil end
    
    local highest = {value = 0}
    
    if AnimalsModule then
        for _, plot in pairs(plots:GetChildren()) do
            if not isPlayerPlot(plot) then
                for _, obj in pairs(plot:GetDescendants()) do
                    if obj:IsA("Model") and AnimalsModule[obj.Name] then
                        pcall(function()
                            local gen = getFinalGeneration(obj)
                            
                            if gen > 0 and gen > highest.value then
                                local root = obj:FindFirstChild("HumanoidRootPart") or obj.PrimaryPart
                                
                                if root then
                                    highest = {
                                        plot = plot,
                                        plotName = plot.Name,
                                        petName = obj.Name,
                                        generation = gen,
                                        model = obj,
                                        value = gen,
                                        position = root.Position,
                                        cframe = root.CFrame
                                    }
                                end
                            end
                        end)
                    end
                end
            end
        end
        
        if highest.value > 0 then return highest end
    end
    
    for _, plot in pairs(plots:GetChildren()) do
        if not isPlayerPlot(plot) then
            for _, obj in pairs(plot:GetDescendants()) do
                if obj:IsA("TextLabel") then
                    local txt = obj.Text or ""
                    
                    if txt:find("/") and txt:lower():find("s") then
                        pcall(function()
                            local nameLabel = nil
                            local parent = obj.Parent
                            
                            if parent then
                                nameLabel = parent:FindFirstChild("DisplayName")
                                if not nameLabel and parent.Parent then
                                    nameLabel = parent.Parent:FindFirstChild("DisplayName")
                                end
                            end
                            
                            if not nameLabel or nameLabel.Text == "" or txt == "" or txt == "N/A" then
                                return
                            end
                            
                            local petName = nameLabel.Text
                            local genText = txt
                            local value = nil
                            
                            if genText:find("T/s") then
                                value = tonumber(genText:match("(%d+%.?%d*)T/s")) * 1e12
                            elseif genText:find("B/s") then
                                value = tonumber(genText:match("(%d+%.?%d*)B/s")) * 1e9
                            elseif genText:find("M/s") then
                                value = tonumber(genText:match("(%d+%.?%d*)M/s")) * 1e6
                            elseif genText:find("K/s") then
                                value = tonumber(genText:match("(%d+%.?%d*)K/s")) * 1e3
                            else
                                value = tonumber(genText:match("(%d+%.?%d*)/s")) or 0
                            end
                            
                            if value and value > 0 and value > highest.value then
                                local model = obj:FindFirstAncestorOfClass('Model')
                                
                                if model then
                                    local part = model.PrimaryPart or model:FindFirstChildWhichIsA('BasePart')
                                    
                                    if part then
                                        highest = {
                                            plot = plot,
                                            plotName = plot.Name,
                                            petName = petName,
                                            generation = value,
                                            model = model,
                                            value = value,
                                            position = part.Position,
                                            cframe = part.CFrame
                                        }
                                    end
                                end
                            end
                        end)
                    end
                end
            end
        end
    end
    
    return highest.value > 0 and highest or nil
end

-- ================================
-- VEHICLE FLY SYSTEM
-- ================================
local FLYING = false
local vehicleflyspeed = 2.0
local CURRENT_Y_OFFSET = 5  -- Default Y offset

local mfly1, mfly2, stealCheckConnection = nil, nil, nil
local v3zero = Vector3.new(0, 0, 0)

local playerModule = nil
local controlModule = nil
pcall(function()
    playerModule = require(player.PlayerScripts:WaitForChild("PlayerModule"))
    controlModule = playerModule:GetControls()
end)

local function getRoot(char)
    if not char then return nil end
    return char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
end

local function NOFLY()
    if mfly1 then mfly1:Disconnect() mfly1 = nil end
    if mfly2 then mfly2:Disconnect() mfly2 = nil end
    if stealCheckConnection then stealCheckConnection:Disconnect() stealCheckConnection = nil end
    
    local root = getRoot(player.Character)
    if root then
        if root:FindFirstChild("VelocityHandler") then root.VelocityHandler:Destroy() end
        if root:FindFirstChild("AlignHandler") then root.AlignHandler:Destroy() end
        if root:FindFirstChild("FlyAttachment") then root.FlyAttachment:Destroy() end
    end
    
    FLYING = false
    stopAutoGrapple()
end

local function startVehicleFly()
    FLYING = true
    local root = getRoot(player.Character)
    local camera = workspace.CurrentCamera
    
    if not root then return end
    
    mfly1 = player.CharacterAdded:Connect(function()
        local root = getRoot(player.Character)
        
        local att = Instance.new("Attachment")
        att.Name = "FlyAttachment"
        att.Parent = root
        
        local lv = Instance.new("LinearVelocity")
        lv.Name = "VelocityHandler"
        lv.Parent = root
        lv.Attachment0 = att
        lv.MaxForce = 9e9
        lv.VectorVelocity = v3zero
        lv.RelativeTo = Enum.ActuatorRelativeTo.World
        
        local ao = Instance.new("AlignOrientation")
        ao.Name = "AlignHandler"
        ao.Parent = root
        ao.Attachment0 = att
        ao.Mode = Enum.OrientationAlignmentMode.OneAttachment
        ao.MaxTorque = 9e9
        ao.Responsiveness = 200
        ao.RigidityEnabled = true
    end)
    
    local att = Instance.new("Attachment")
    att.Name = "FlyAttachment"
    att.Parent = root
    
    local lv = Instance.new("LinearVelocity")
    lv.Name = "VelocityHandler"
    lv.Parent = root
    lv.Attachment0 = att
    lv.MaxForce = 9e9
    lv.VectorVelocity = v3zero
    lv.RelativeTo = Enum.ActuatorRelativeTo.World
    
    local ao = Instance.new("AlignOrientation")
    ao.Name = "AlignHandler"
    ao.Parent = root
    ao.Attachment0 = att
    ao.Mode = Enum.OrientationAlignmentMode.OneAttachment
    ao.MaxTorque = 9e9
    ao.Responsiveness = 200
    ao.RigidityEnabled = true
    
    mfly2 = RunService.RenderStepped:Connect(function()
        root = getRoot(player.Character)
        camera = workspace.CurrentCamera
        
        if player.Character:FindFirstChildWhichIsA("Humanoid") and root and root:FindFirstChild("VelocityHandler") and root:FindFirstChild("AlignHandler") then
            local VelocityHandler = root.VelocityHandler
            local AlignHandler = root.AlignHandler
            
            AlignHandler.CFrame = camera.CFrame
            local velocity = Vector3.new(0, 0, 0)
            local direction = controlModule:GetMoveVector()
            
            if direction.X ~= 0 then
                velocity = velocity + camera.CFrame.RightVector * (direction.X * vehicleflyspeed * 50)
            end
            if direction.Z ~= 0 then
                velocity = velocity - camera.CFrame.LookVector * (direction.Z * vehicleflyspeed * 50)
            end
            
            if UserInputService:IsKeyDown(Enum.KeyCode.E) then
                velocity = velocity + Vector3.new(0, vehicleflyspeed * 50, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Q) then
                velocity = velocity - Vector3.new(0, vehicleflyspeed * 50, 0)
            end
            
            VelocityHandler.VectorVelocity = velocity
        end
    end)
    
    startAutoGrapple()
    
    stealCheckConnection = RunService.Heartbeat:Connect(function()
        local isStealingNow = player:GetAttribute("Stealing")
        if isStealingNow == true then
            NOFLY()
        end
    end)
end

-- ================================
-- UI CREATION
-- ================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PetDetectorUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 400, 0, 520)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -260)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 15)
Corner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(100, 50, 255)
Stroke.Thickness = 3
Stroke.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 50)
Title.BackgroundTransparency = 1
Title.Text = "ğŸ¯ PET DETECTOR + AUTO FLY"
Title.TextColor3 = Color3.fromRGB(150, 100, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.Parent = MainFrame

-- Pet Info Frame
local InfoFrame = Instance.new("Frame")
InfoFrame.Size = UDim2.new(1, -20, 0, 180)
InfoFrame.Position = UDim2.new(0, 10, 0, 60)
InfoFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
InfoFrame.BorderSizePixel = 0
InfoFrame.Parent = MainFrame

local InfoCorner = Instance.new("UICorner")
InfoCorner.CornerRadius = UDim.new(0, 10)
InfoCorner.Parent = InfoFrame

local PetNameLabel = Instance.new("TextLabel")
PetNameLabel.Size = UDim2.new(1, -10, 0, 30)
PetNameLabel.Position = UDim2.new(0, 5, 0, 5)
PetNameLabel.BackgroundTransparency = 1
PetNameLabel.Text = "ğŸ¾ Pet: Not Found"
PetNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
PetNameLabel.Font = Enum.Font.GothamBold
PetNameLabel.TextSize = 14
PetNameLabel.TextXAlignment = Enum.TextXAlignment.Left
PetNameLabel.Parent = InfoFrame

local ValueLabel = Instance.new("TextLabel")
ValueLabel.Size = UDim2.new(1, -10, 0, 25)
ValueLabel.Position = UDim2.new(0, 5, 0, 35)
ValueLabel.BackgroundTransparency = 1
ValueLabel.Text = "ğŸ’° Value: 0"
ValueLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
ValueLabel.Font = Enum.Font.Gotham
ValueLabel.TextSize = 13
ValueLabel.TextXAlignment = Enum.TextXAlignment.Left
ValueLabel.Parent = InfoFrame

local PlotLabel = Instance.new("TextLabel")
PlotLabel.Size = UDim2.new(1, -10, 0, 25)
PlotLabel.Position = UDim2.new(0, 5, 0, 60)
PlotLabel.BackgroundTransparency = 1
PlotLabel.Text = "ğŸ“ Plot: N/A"
PlotLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
PlotLabel.Font = Enum.Font.Gotham
PlotLabel.TextSize = 12
PlotLabel.TextXAlignment = Enum.TextXAlignment.Left
PlotLabel.Parent = InfoFrame

local PosLabel = Instance.new("TextLabel")
PosLabel.Size = UDim2.new(1, -10, 0, 25)
PosLabel.Position = UDim2.new(0, 5, 0, 85)
PosLabel.BackgroundTransparency = 1
PosLabel.Text = "ğŸ“Œ Pos: X:0, Y:0, Z:0"
PosLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
PosLabel.Font = Enum.Font.Gotham
PosLabel.TextSize = 11
PosLabel.TextXAlignment = Enum.TextXAlignment.Left
PosLabel.Parent = InfoFrame

local YOffsetLabel = Instance.new("TextLabel")
YOffsetLabel.Size = UDim2.new(1, -10, 0, 25)
YOffsetLabel.Position = UDim2.new(0, 5, 0, 110)
YOffsetLabel.BackgroundTransparency = 1
YOffsetLabel.Text = "âœˆï¸ Height Offset: +5"
YOffsetLabel.TextColor3 = Color3.fromRGB(255, 150, 255)
YOffsetLabel.Font = Enum.Font.GothamBold
YOffsetLabel.TextSize = 13
YOffsetLabel.TextXAlignment = Enum.TextXAlignment.Left
YOffsetLabel.Parent = InfoFrame

local HeightInfo = Instance.new("TextLabel")
HeightInfo.Size = UDim2.new(1, -10, 0, 35)
HeightInfo.Position = UDim2.new(0, 5, 0, 135)
HeightInfo.BackgroundTransparency = 1
HeightInfo.Text = "âš ï¸ Adjust height sebelum fly!"
HeightInfo.TextColor3 = Color3.fromRGB(255, 200, 0)
HeightInfo.Font = Enum.Font.Gotham
HeightInfo.TextSize = 10
HeightInfo.TextWrapped = true
HeightInfo.TextXAlignment = Enum.TextXAlignment.Left
HeightInfo.Parent = InfoFrame

-- Height Adjustment Frame
local HeightFrame = Instance.new("Frame")
HeightFrame.Size = UDim2.new(1, -20, 0, 80)
HeightFrame.Position = UDim2.new(0, 10, 0, 250)
HeightFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
HeightFrame.BorderSizePixel = 0
HeightFrame.Parent = MainFrame

local HeightCorner = Instance.new("UICorner")
HeightCorner.CornerRadius = UDim.new(0, 10)
HeightCorner.Parent = HeightFrame

local HeightTitle = Instance.new("TextLabel")
HeightTitle.Size = UDim2.new(1, 0, 0, 25)
HeightTitle.BackgroundTransparency = 1
HeightTitle.Text = "ğŸšï¸ ADJUST HEIGHT (Y Offset)"
HeightTitle.TextColor3 = Color3.fromRGB(200, 200, 200)
HeightTitle.Font = Enum.Font.GothamBold
HeightTitle.TextSize = 12
HeightTitle.Parent = HeightFrame

local MinusBtn = Instance.new("TextButton")
MinusBtn.Size = UDim2.new(0, 80, 0, 40)
MinusBtn.Position = UDim2.new(0, 10, 0, 30)
MinusBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
MinusBtn.Text = "â– -5"
MinusBtn.TextColor3 = Color3.new(1, 1, 1)
MinusBtn.Font = Enum.Font.GothamBold
MinusBtn.TextSize = 16
MinusBtn.Parent = HeightFrame

local MinusCorner = Instance.new("UICorner")
MinusCorner.CornerRadius = UDim.new(0, 8)
MinusCorner.Parent = MinusBtn

local CurrentYLabel = Instance.new("TextLabel")
CurrentYLabel.Size = UDim2.new(0, 180, 0, 40)
CurrentYLabel.Position = UDim2.new(0, 100, 0, 30)
CurrentYLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
CurrentYLabel.Text = "+5"
CurrentYLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
CurrentYLabel.Font = Enum.Font.GothamBold
CurrentYLabel.TextSize = 20
CurrentYLabel.Parent = HeightFrame

local CurrentYCorner = Instance.new("UICorner")
CurrentYCorner.CornerRadius = UDim.new(0, 8)
CurrentYCorner.Parent = CurrentYLabel

local PlusBtn = Instance.new("TextButton")
PlusBtn.Size = UDim2.new(0, 80, 0, 40)
PlusBtn.Position = UDim2.new(0, 290, 0, 30)
PlusBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
PlusBtn.Text = "â• +5"
PlusBtn.TextColor3 = Color3.new(1, 1, 1)
PlusBtn.Font = Enum.Font.GothamBold
PlusBtn.TextSize = 16
PlusBtn.Parent = HeightFrame

local PlusCorner = Instance.new("UICorner")
PlusCorner.CornerRadius = UDim.new(0, 8)
PlusCorner.Parent = PlusBtn

-- Detect Button
local DetectBtn = Instance.new("TextButton")
DetectBtn.Size = UDim2.new(1, -20, 0, 50)
DetectBtn.Position = UDim2.new(0, 10, 0, 340)
DetectBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 255)
DetectBtn.Text = "ğŸ” DETECT HIGHEST PET"
DetectBtn.TextColor3 = Color3.new(1, 1, 1)
DetectBtn.Font = Enum.Font.GothamBold
DetectBtn.TextSize = 18
DetectBtn.Parent = MainFrame

local DetectCorner = Instance.new("UICorner")
DetectCorner.CornerRadius = UDim.new(0, 10)
DetectCorner.Parent = DetectBtn

-- Fly Button
local FlyBtn = Instance.new("TextButton")
FlyBtn.Size = UDim2.new(1, -20, 0, 50)
FlyBtn.Position = UDim2.new(0, 10, 0, 400)
FlyBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
FlyBtn.Text = "ğŸš€ FLY TO PET (OFF)"
FlyBtn.TextColor3 = Color3.new(1, 1, 1)
FlyBtn.Font = Enum.Font.GothamBold
FlyBtn.TextSize = 18
FlyBtn.Parent = MainFrame

local FlyCorner = Instance.new("UICorner")
FlyCorner.CornerRadius = UDim.new(0, 10)
FlyCorner.Parent = FlyBtn

-- Status
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 25)
StatusLabel.Position = UDim2.new(0, 10, 0, 460)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Status: Idle ğŸ”µ"
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.Parent = MainFrame

local GrappleLabel = Instance.new("TextLabel")
GrappleLabel.Size = UDim2.new(1, -20, 0, 25)
GrappleLabel.Position = UDim2.new(0, 10, 0, 485)
GrappleLabel.BackgroundTransparency = 1
GrappleLabel.Text = "ğŸª Grapple: Inactive"
GrappleLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
GrappleLabel.Font = Enum.Font.Gotham
GrappleLabel.TextSize = 11
GrappleLabel.Parent = MainFrame

-- ================================
-- BUTTON HANDLERS
-- ================================
local currentTarget = nil

MinusBtn.MouseButton1Click:Connect(function()
    CURRENT_Y_OFFSET = math.max(-50, CURRENT_Y_OFFSET - 5)
    CurrentYLabel.Text = (CURRENT_Y_OFFSET >= 0 and "+" or "") .. tostring(CURRENT_Y_OFFSET)
    YOffsetLabel.Text = "âœˆï¸ Height Offset: " .. (CURRENT_Y_OFFSET >= 0 and "+" or "") .. tostring(CURRENT_Y_OFFSET)
end)

PlusBtn.MouseButton1Click:Connect(function()
    CURRENT_Y_OFFSET = math.min(100, CURRENT_Y_OFFSET + 5)
    CurrentYLabel.Text = (CURRENT_Y_OFFSET >= 0 and "+" or "") .. tostring(CURRENT_Y_OFFSET)
    YOffsetLabel.Text = "âœˆï¸ Height Offset: " .. (CURRENT_Y_OFFSET >= 0 and "+" or "") .. tostring(CURRENT_Y_OFFSET)
end)

DetectBtn.MouseButton1Click:Connect(function()
    StatusLabel.Text = "Status: Scanning... ğŸ”"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
    
    local best = findTheAbsoluteBestPet()
    
    if best then
        currentTarget = best
        PetNameLabel.Text = "ğŸ¾ Pet: " .. best.petName
        ValueLabel.Text = "ğŸ’° Value: " .. tostring(best.value)
        PlotLabel.Text = "ğŸ“ Plot: " .. best.plotName
        
        local pos = best.position
        PosLabel.Text = string.format("ğŸ“Œ Pos: X:%.1f, Y:%.1f, Z:%.1f", pos.X, pos.Y, pos.Z)
        
        StatusLabel.Text = "Status: Pet Found! âœ…"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        FlyBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 100)
    else
        currentTarget = nil
        PetNameLabel.Text = "ğŸ¾ Pet: Not Found"
        ValueLabel.Text = "ğŸ’° Value: 0"
        PlotLabel.Text = "ğŸ“ Plot: N/A"
        PosLabel.Text = "ğŸ“Œ Pos: X:0, Y:0, Z:0"
        
        StatusLabel.Text = "Status: No pets detected âŒ"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        FlyBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    end
end)

FlyBtn.MouseButton1Click:Connect(function()
    if not currentTarget then
        StatusLabel.Text = "Status: Detect pet first! âš ï¸"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 150, 0)
        return
    end
    
    if FLYING then
        NOFLY()
        FlyBtn.Text = "ğŸš€ FLY TO PET (OFF)"
        FlyBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
        StatusLabel.Text = "Status: Fly Stopped ğŸ”´"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        GrappleLabel.Text = "ğŸª Grapple: Inactive"
        GrappleLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    else
        startVehicleFly()
        
        local targetPos = currentTarget.position
        local approachPos = Vector3.new(targetPos.X, targetPos.Y + CURRENT_Y_OFFSET, targetPos.Z)
        
        local root = getRoot(player.Character)
        if root then
            root.CFrame = CFrame.new(approachPos)
        end
        
        FlyBtn.Text = "â¸ï¸ STOP FLY"
        FlyBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 50)
        StatusLabel.Text = "Status: Flying to Pet! ğŸš€"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        GrappleLabel.Text = "ğŸª Grapple: ACTIVE ğŸ”¥"
        GrappleLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
    end
end)

-- ================================
-- AUTO UPDATE STATUS
-- ================================
player.CharacterAdded:Connect(function(char)
    character = char
    task.wait(1)
    if FLYING then
        NOFLY()
        FlyBtn.Text = "ğŸš€ FLY TO PET (OFF)"
        FlyBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
        StatusLabel.Text = "Status: Respawned - Fly OFF ğŸ”´"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        GrappleLabel.Text = "ğŸª Grapple: Inactive"
        GrappleLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    end
end)

-- Auto detect stealing
RunService.Heartbeat:Connect(function()
    if FLYING then
        local isStealingNow = player:GetAttribute("Stealing")
        if isStealingNow == true then
            NOFLY()
            FlyBtn.Text = "ğŸš€ FLY TO PET (OFF)"
            FlyBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
            StatusLabel.Text = "Status: AUTO OFF (Stealing) ğŸ›‘"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 150, 0)
            GrappleLabel.Text = "ğŸª Grapple: Inactive"
            GrappleLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
        end
    end
end)
